# Enhanced Alert Publisher for Observability Agent

This script provides an enhanced way to generate and publish test alerts to the Observability Agent system. It supports various alert types, customization options, and can generate both active and resolved alerts.

## Features

- Generate alerts of specific types or random types
- Customize service names
- Generate resolved alerts (with end times) or active alerts
- Set specific status for active alerts (open, acknowledged, in_progress)
- Generate a mix of active and resolved alerts
- Configurable number of alerts and interval between them

## Alert Types

The script supports the following alert types:

1. **CPU Usage** (`cpu`): High CPU usage alerts
2. **Memory Usage** (`memory`): High memory usage alerts
3. **Latency** (`latency`): High request latency alerts
4. **Error Rate** (`error_rate`): High error rate alerts
5. **Deployment** (`deployment`): Failed deployment alerts
6. **Disk Usage** (`disk`): High disk usage alerts
7. **Network** (`network`): Network latency alerts
8. **Database** (`database`): Database connection issue alerts

## Prerequisites

- Python 3.7+
- NATS server running
- Required Python packages:
  ```
  nats-py>=2.2.0
  ```

## Installation

1. Make sure you have Python 3.7+ installed
2. Install the required packages:
   ```bash
   pip install -r requirements-alert-publisher.txt
   ```
3. Make the script executable:
   ```bash
   chmod +x enhanced_alert_publisher.py
   ```

## Usage

### Basic Usage

Generate a single random alert:

```bash
./enhanced_alert_publisher.py --nats-server nats://localhost:4222
```

### Generate Specific Alert Types

```bash
# Generate a CPU usage alert
./enhanced_alert_publisher.py --alert-type cpu

# Generate a memory usage alert
./enhanced_alert_publisher.py --alert-type memory

# Generate a latency alert
./enhanced_alert_publisher.py --alert-type latency

# Generate an error rate alert
./enhanced_alert_publisher.py --alert-type error_rate

# Generate a deployment alert
./enhanced_alert_publisher.py --alert-type deployment

# Generate a disk usage alert
./enhanced_alert_publisher.py --alert-type disk

# Generate a network latency alert
./enhanced_alert_publisher.py --alert-type network

# Generate a database connection issue alert
./enhanced_alert_publisher.py --alert-type database
```

### Generate Multiple Alerts

```bash
# Generate 5 random alerts with 2-second intervals
./enhanced_alert_publisher.py --count 5 --interval 2
```

### Generate Alerts for a Specific Service

```bash
# Generate alerts for a specific service
./enhanced_alert_publisher.py --service payment-service --count 3
```

### Generate Resolved Alerts

```bash
# Generate resolved alerts (with end times)
./enhanced_alert_publisher.py --resolved --count 3
```

### Generate a Mix of Active and Resolved Alerts

```bash
# Generate a mix of active and resolved alerts
./enhanced_alert_publisher.py --mixed --count 10
```

### Set Specific Status for Active Alerts

```bash
# Generate alerts with a specific status
./enhanced_alert_publisher.py --status acknowledged --count 3
```

### Combine Options

```bash
# Generate 5 CPU alerts for payment-service with acknowledged status
./enhanced_alert_publisher.py --alert-type cpu --service payment-service --status acknowledged --count 5
```

## Alert Format

The alerts generated by this script follow this format:

```json
{
  "id": "alert-<uuid>",
  "labels": {
    "alertname": "<AlertName>",
    "service": "<ServiceName>",
    "severity": "<Severity>",
    "environment": "<Environment>",
    "instance": "instance-<N>",
    "namespace": "default"
  },
  "annotations": {
    "summary": "<Summary>",
    "description": "<Description>",
    "value": "<Value>",
    "threshold": "<Threshold>"
  },
  "startsAt": "<ISO8601 Timestamp>",
  "endsAt": "<ISO8601 Timestamp or null>",
  "status": "<Status>",
  "generatorURL": "http://observability-agent-alert-publisher"
}
```

## Testing the Observability Agent

This script is useful for testing various components of the Observability Agent:

1. **Alert Processing**: Test how the system processes different types of alerts
2. **Root Cause Analysis**: Generate related alerts to test root cause analysis
3. **Runbook Generation**: Test runbook generation for different alert types
4. **UI Display**: Test how alerts are displayed in the UI
5. **Notification System**: Test alert notifications

## Kubernetes Deployment

To run this script in a Kubernetes environment:

1. Build a container image with the script
2. Deploy it as a Job or CronJob
3. Configure it to connect to the NATS service in your cluster

Example Kubernetes manifest:

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: alert-publisher
spec:
  template:
    spec:
      containers:
      - name: alert-publisher
        image: your-registry/alert-publisher:latest
        args:
        - --nats-server=nats://observability-agent-nats:4222
        - --count=10
        - --interval=5
        - --mixed
      restartPolicy: Never
  backoffLimit: 1
```
